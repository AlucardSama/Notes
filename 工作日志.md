## 账号密码
SVN账号：ZhengJianAn = Wmhlbm
地址：http://192.168.2.99/svn

## 2016.07.25-07.29
#### 车联天下

    1.车联天下一键导航更改“地图上的点”为具体的地理位置信息；
    
    2.行车统计模块的出发点图标错误修改；
    
#### 掌上车卫士服务端

1. 掌上车卫士服务端增加SN登录功能，修改SmartLocation_Sp_SimNumUserCheckLogin存储过程；

2. [SmartLocation_Sp_InsertLoginLog]存储过程增加SN(TermSerial)子号登录时写入登陆信息or a.TermSerial = @UserId；

3. [SmartLocation_View_UserCar]添加b.TermSerial  即SN号；
    
4. [SmartLocation_Sp_GetTerminalInfo]修改SN号获取终端信息CarNum as CarName,SimNum,TermSerial as SN；
    
5. SmartCar.BLL.Common.M_UserBLL中的CheckAuthorityMd5，登录时不管是Sim卡号，车牌号，SN号登录，都返回SimNum as UserId；见图片
    
6. 车辆的实时位置信息的获取是从WCF获取，测试的账号为SimNum 8615159634830，SN A173011313A5440517
```xml
<!--WCF数据缓存服务的IP  掌上车卫士-->
<add key="WCFIp" value="192.168.60.76:6969"/>
```


#### 英搏尔协议

1. 英搏尔协议联调






## 2016.08.01-08.05

#### 掌上车卫士服务端
	
1. 服务端功能需求：批量导入的设备在掌上车卫士进行绑定之后，设备的AreaId会改变，导致[车卫士管理分析系统](http://192.168.60.70:10423/Stargps/Login.aspx)中新建分类文件夹，不好管理；

2. 解决办法：原先的做法是将该设备的AreaId改成绑定主号所属区域（集团）的AreaId，若不存在则创建一个新的区域；现在的做法是直接将UserId和CarId的数据绑定存储到GpsUserAreaAndCar表中；


#### Android加强学习方向
	
1. Rxjava okHttp Retrofit ...
2. MVP MVVM
3. 自定义View的学习  [博客](http://blog.csdn.net/lfdfhl/article/details/51324275)


## 2016.08.08-08.12

#### Ngrok内网穿透

1. 应用ID:59df93697fcd1def  访问地址:[unlimited.ngrok.cc](unlimited.ngrok.cc)
2. Ngrok后台管理地中心：[http://www.ngrok.cc/index.php/login/index.html](http://www.ngrok.cc/index.php/login/index.html);
3. [Ngrok配置使用教程](http://www.ngrok.cc/);
4. apache虚拟目录设置 在httpd-vhosts.conf下配置为(Apache 2.2配置方法);

		`<VirtualHost *:80>
			DocumentRoot D:/wamp/www
			ServerName localhost
			<Directory "D:/wamp/www">
				Options Indexes FollowSymLinks
				AllowOverride None
				Order allow,deny
				Allow from all
			</Directory>
		</VirtualHost>`


## 2016.08.15-08.19

#### Android Studio导入新的Module
1. 查看目标文件是Module还是Project；
2. 导入成功后，修改编译的sdk版本和gradle版本；
3. 同步sync projects；
4. 。。。

#### 账号密码

##### 阿里云
账号：aolukeji
密码：Alkj@2016

##### 服务器地址
114.215.184.124（外）
10.162.87.176 (内)
登陆账号：Administrator
密码：Alkj@2016

##### 微擎管理系统登陆
内网：
http://192.168.61.74:16005/ppphp/web/index.php?c=account&a=display
账号：admin
密码：admin888


#### 掌上车卫士服务端

1. 手工录入的设备，也要求用户可通过SN号登陆手机客户端；
2. 手机客户端（含IOS&安卓），绑定车辆成功后，车辆列表就可以查到绑定的车辆信息，无需等到定位成功后。若车辆未定位，用户点击车辆后，提示 车辆暂未定位；手机客户端绑定设备时，输入的SIM卡号码更新至管理分析系统设备sim卡号字段（原本是更新至车牌号）；

#### 脚本更新时添加Log信息
```sql
GO
INSERT INTO GpsWebLog 
 VALUES('info','upgrade',NULL,GETDATE(),'Sim卡号更新到Sim_mobile字段，V3.01.3',1,1);
```


## 2016/8/25 10:36:59 

> 变化：
RecMsgCom_Alarm_Insert 插入报警数据七天报警数据；
新增表GPSALARMDATA_FF_FILTER；
已有GPSRECEBUFFER_FF_Filter 报警数据，过期时间为10分钟；
appsvr_ClearExpireReceData 删除过期的数据；
新增存储过程SmartLocation_Sp_GetAlarmInfo

定义接口：
获取报警信息数量getAlarmCount()
携带参数

获取报警信息的内容
getAlarmData()
携带参数


## 2016/8/26 15:03:35 

定时服务 

新增表 GPSALARMDATA_FF_Filter

``` sql
USE [gpsdb2_DEV]
GO

/****** Object:  Table [dbo].[GPSALARMDATA_FF_Filter]    Script Date: 2016/8/29 16:03:45 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

IF EXISTS (SELECT * FROM SYSOBJECTS WHERE ID = OBJECT_ID(N'[GPSALARMDATA_FF_Filter]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [GPSALARMDATA_FF_Filter]
GO

CREATE TABLE [dbo].[GPSALARMDATA_FF_Filter](
	[mid] [bigint] IDENTITY(1,1) NOT NULL,
	[telephone] [varchar](20) NULL,
	[recetime] [datetime] NULL,
	[gpsTime] [datetime] NULL,
	[INSTIME] [datetime] NULL,
	[DelTime] [datetime] NULL,
	[alarmInfo] [varchar](50) NULL,
 CONSTRAINT [PK_GPSALARMDATA_FF_Filter] PRIMARY KEY CLUSTERED 
(
	[mid] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[GPSALARMDATA_FF_Filter] ADD  DEFAULT (getdate()) FOR [INSTIME]
GO

ALTER TABLE [dbo].[GPSALARMDATA_FF_Filter] ADD  DEFAULT (dateadd(day,(7),getdate())) FOR [DelTime]
GO

GO
INSERT INTO GpsWebLog 
VALUES('info','CREATE',NULL,GETDATE(),'新建表GPSALARMDATA_FF_FILTER存储报警信息',1,1);

```


## 2016/8/29 16:18:55 

1. 添加新的DataType AppSvr_TYPE_AlarmInfo
```sql
USE [gpsdb2_DEV]
GO

/****** Object:  UserDefinedTableType [dbo].[AppSvr_TYPE_AlarmInfo]    Script Date: 08/25/2016 19:52:11 ******/
IF  EXISTS (SELECT * FROM sys.types st JOIN sys.schemas ss ON st.schema_id = ss.schema_id WHERE st.name = N'AppSvr_TYPE_AlarmInfo' AND ss.name = N'dbo')
DROP TYPE [dbo].[AppSvr_TYPE_AlarmInfo]
GO

USE [gpsdb2_DEV]
GO

/****** Object:  UserDefinedTableType [dbo].[AppSvr_TYPE_AlarmInfo]  Script Date: 08/25/2016 19:52:11 ******/
CREATE TYPE [dbo].[AppSvr_TYPE_AlarmInfo] AS TABLE(
	[telephone] [varchar](20) NULL,
	[recetime] [datetime] NULL,
	[gpsTime] [datetime] NULL,
	[alarmLoaction] [varchar](50) NULL,
	[alarmInfo] [varchar](50) NULL,
	[carStatu] [int] NULL,
	[carStatuEx] [bigint] NULL
)
GO

GO
INSERT INTO GpsWebLog 
VALUES('info','CREATE',NULL,GETDATE(),'新建AppSvr_TYPE_AlarmInfo自定义类型',1,1);

```

2. 添加存储DataTable的存储过程；AppSvr_AlarmInfoTrans
```sql
USE gpsdb2_DEV
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO


IF (EXISTS (SELECT * FROM sys.objects WHERE NAME = 'AppSvr_AlarmInfoTrans'))
    DROP PROC AppSvr_AlarmInfoTrans
GO


CREATE PROCEDURE AppSvr_AlarmInfoTrans 

    @alarmTable AS dbo.AppSvr_TYPE_AlarmInfo READONLY
		
AS
BEGIN
	
	INSERT INTO GPSALARMDATA_FF_Filter (telephone,recetime,gpsTime,alarmLocation,alarmInfo)
	(SELECT a.telephone,a.recetime,a.gpsTime,a.alarmLoaction,dbo.WebMgr_Fun_GetCarAlarmStatusName(b.CarId,1,a.carStatu,a.carStatuEx) as alarmInfo FROM @alarmTable a INNER JOIN GisCar b on b.SimNum=a.telephone)
	
END
GO

INSERT INTO GpsWebLog 
VALUES('info','CREATE',NULL,GETDATE(),'新建AppSvr_AlarmInfoTrans存储过程，存储转换后的报警信息和地理位置信息',1,1);


```

## 2016/8/31 11:13:28 

1. 新增表 GPSAlarm_TBL_ReqTime 存储用户请求的时间；

``` sql
USE [gpsdb2_DEV]
GO

/****** Object:  Table [dbo].[GPSAlarm_TBL_ReqTime]    Script Date: 2016/8/31 11:14:59 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO

IF EXISTS (SELECT * FROM SYSOBJECTS WHERE ID = OBJECT_ID(N'[GPSAlarm_TBL_ReqTime]') AND OBJECTPROPERTY(id, N'IsUserTable') = 1) 
DROP TABLE [GPSAlarm_TBL_ReqTime]
GO

CREATE TABLE [dbo].[GPSAlarm_TBL_ReqTime](
	[userId] [varchar](20) NOT NULL,
	[reqTime] [varchar](50) NULL,
 CONSTRAINT [PK_GPSAlarm_TBL_ReqTime] PRIMARY KEY CLUSTERED 
(
	[userId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

GO
INSERT INTO GpsWebLog 
VALUES('info','CREATE',NULL,GETDATE(),'新建表GPSAlarm_TBL_ReqTime记录报警信息请求时间',1,1);

```
2. 分页查询  新增pageId，去除reqTime字段，返回新增pageId和pageCount

修改 SmartLocation_Sp_GetAlarmInfo 存储过程，暂时不管分页

``` sql
USE [gpsdb2_DEV]
GO

/****** Object:  StoredProcedure [dbo].[SmartLocation_Sp_GetAlarmInfo]    Script Date: 2016/8/31 10:51:03 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

-- =============================================
-- Author:		<jianan zheng>
-- Create date: <2016-08-25>
-- Description:	<获取报警信息的数量和具体内容>
-- =============================================

ALTER PROCEDURE [dbo].[SmartLocation_Sp_GetAlarmInfo] 
   @SimNum VARCHAR(20),		--SIMNUM
   @IsMember INT,			--是否子号  0-主号  1-子号
   @type   VARCHAR(10),		--请求的类型,count为数量，field为内容
   @startIndex   INT,			--请求开始
   @endIndex INT				--请求结束
AS
--获取当前的时间
DECLARE @currTime VARCHAR(50)
SELECT @currTime=CONVERT(VARCHAR(50), GETDATE(), 20)
--上次的请求时间
DECLARE @reqTime VARCHAR(50)

BEGIN
SELECT @reqTime=reqTime FROM GPSAlarm_TBL_ReqTime where userId=@SimNum
IF ISNULL(@reqTime,'') = ''
  BEGIN
  set @reqTime= DATEADD(day,-30,GETDATE())
  --插入新数据到最后请求的时间表  测试注释
  --INSERT INTO GPSAlarm_TBL_ReqTime (userId,reqTime) 
  --VALUES (@SimNum,@currTime)
  END
IF(@IsMember=0)
--主号
 BEGIN
  IF(@type='count')
	BEGIN
	--获取报警信息条数
	SELECT COUNT(1) as AlarmCount FROM dbo.SmartLocation_View_UserCar a 
			INNER JOIN GPSALARMDATA_FF_Filter b on a.SimNum=b.telephone
				WHERE a.UserId=@SimNum AND b.recetime>@reqTime AND recetime<@currTime
	END
  ELSE IF(@type='field')
    BEGIN


	--获取报警信息的内容

	WITH alarmList AS(
	SELECT ROW_NUMBER() OVER (ORDER BY b.recetime DESC) ROWNUM,a.CarNum,b.recetime,b.gpsTime,b.alarmLocation,b.alarmInfo
	 FROM  dbo.SmartLocation_View_UserCar a 
			INNER JOIN GPSALARMDATA_FF_Filter b ON a.SimNum=b.telephone
	WHERE a.UserId=@SimNum AND b.recetime>@reqTime AND b.recetime<@currTime) 				
    SELECT * 
	FROM alarmList 
	WHERE ROWNUM BETWEEN @startIndex AND @endIndex  
	--更新最后请求的时间表 测试
	--UPDATE GPSAlarm_TBL_ReqTime SET reqTime=@currTime
	END	
 END			
--子号查询
ELSE
 BEGIN
 IF(@type='count')
	BEGIN
	 select COUNT(1)  
	 FROM GPSALARMDATA_FF_Filter
	 WHERE telephone=@SimNum AND recetime>@reqTime AND recetime<@currTime; 	
	END
  ELSE IF(@type='field')
    BEGIN

	 --获取子号的报警信息
	 WITH alarmList AS (

	 SELECT ROW_NUMBER() OVER (ORDER BY recetime DESC) ROWNUM,b.CarNum,a.recetime,a.alarmLocation,a.alarmInfo
	 FROM GPSALARMDATA_FF_Filter a INNER JOIN GisCar b ON a.telephone=b.SimNum
	 WHERE telephone=@SimNum AND recetime>@reqTime AND recetime<@currTime)
	 SELECT * 
	 FROM alarmList 
	 WHERE ROWNUM BETWEEN @startIndex AND @endIndex
	 --更新最后请求的时间表 测试
	 --UPDATE GPSAlarm_TBL_ReqTime SET reqTime=@currTime

	END	
 END
END

GO

```















    
